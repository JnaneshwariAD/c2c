import{v as y,c as g,S as l,d as ge,r as n,j as r,M as je,B as D,b as P,e as ye,G as p,g as Ce,P as Ie,f as Ee,h as be,i as ve,k as V,l as c,m as Me,I as J,E as Ne,D as Ue,n as De,o as Pe,p as Be,q as b,F as q,A as Y,H as K,J as Q,Q as _,K as X,R as Se,s as we,t as Z}from"./index-D1P8NqU1.js";const Te=async i=>await y({method:"GET",url:`${g}/module/v1/getAllModuleByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10`,headers:i}),Fe=async i=>await y({method:"GET",url:`${g}/course/v1/queryAllCourses`,headers:i}),ke=async(i,f)=>{try{const d=await y({method:"POST",url:`${g}/module/v1/createModule`,headers:f,data:JSON.stringify(i)});d.data.responseCode===201?l.fire("Success",d.data.message,"success"):d.data.responseCode===400&&l.fire("Error",d.data.errorMessage,"error")}catch(d){l.fire("Error",d.message||"An error occurred","error")}},Le=async(i,f)=>await y({method:"GET",url:`${g}/module/v1/getModuleByModuleId/{moduleId}?moduleId=${i}`,headers:f}),Ae=async(i,f)=>{try{const d=await y({method:"PUT",url:`${g}/module/v1/updateModule`,headers:f,data:i});d.data.responseCode===201?l.fire("Updated",d.data.message,"success"):d.data.responseCode===400&&l.fire("Error",d.data.errorMessage,"error")}catch(d){l.fire("Error",d.message||"An error occurred","error")}},Oe=async(i,f)=>{var d,j;try{const h=await y({method:"DELETE",url:`${g}/module/v1/deleteModuleById/${i}`,headers:f});h.data.responseCode===200?l.fire("Deleted",h.data.message,"success"):h.data.responseCode===400&&l.fire("Error",h.data.errorMessage,"error")}catch(h){l.fire("Error",((j=(d=h.response)==null?void 0:d.data)==null?void 0:j.errorMessage)||h.message,"error")}},We=[{id:"moduleId",label:"Module No"},{id:"moduleName",label:"Name",minWidth:100},{id:"description",label:"Description",minWidth:100},{id:"courseName",label:"Course"},{id:"semester",label:"Semester"},{id:"url",label:"Url"},{id:"videoUrl",label:"VideoUrl"},{id:"file",label:"File",minWidth:200},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],$e=()=>{const i=ge(),[f,d]=n.useState(0),[j,h]=n.useState(10),[C,L]=n.useState([]),[A,O]=n.useState([]),[ee,E]=n.useState(!1),[B,W]=n.useState(!1),[o,x]=n.useState({moduleName:"",description:"",courseId:[],videoUrl:"",semester:[],url:"",fileName:"",filePath:null}),[u,v]=n.useState({}),[M,S]=n.useState(!1),[re,te]=n.useState(null),[w,T]=n.useState(null),[R,$]=n.useState(0),[F,z]=n.useState(!1),oe=n.useRef(null);n.useState([]);const se=`${g}/file/downloadFile/?filePath=`,ae=(e,a)=>{d(a)},le=e=>{h(+e.target.value),d(0)},N=JSON.parse(sessionStorage.getItem("user")),I={"Content-type":"application/json",Authorization:"Bearer "+N.accessToken},ie={"Content-Type":"multipart/form-data",Authorization:"Bearer "+N.accessToken},de=async()=>{try{const e=await Te(I);if(!e||!e.data)throw new Error("Invalid API response");const s=(e.data.content||[]).map(t=>{var m;return{moduleId:t.moduleId,moduleName:t.moduleName,description:t.description,semester:t.semester,courseName:((m=t.courseDtoList)==null?void 0:m.map(k=>k.courseName).join(", "))||"No course",url:t.url,videoUrl:t.videoUrl,file:t.filePath===null?"NO FILE FOUND":r.jsx("img",{src:se+t.filePath,alt:t.fileName,style:{width:100,height:50}}),insertedDate:Z(t.insertedDate).format("L"),updatedDate:Z(t.updatedDate).format("L"),createdBy:t.createdBy?t.createdBy.userName:"No User",updatedBy:t.updatedBy?t.updatedBy.userName:"No User"}});O(s)}catch(e){console.error("Error fetching modules:",e),l.fire({icon:"error",title:"Error",text:"Failed to fetch modules",confirmButtonColor:i.palette.primary.main}),O([])}},ne=async()=>{try{const e=await Fe(I);if(!e||!e.data)throw new Error("Invalid API response");const t=(e.data||[]).sort((m,k)=>m.courseName.localeCompare(k.courseName)).map(m=>({courseId:m.courseId,courseName:m.courseName,semester:m.semester}));L(t)}catch(e){console.error("Error fetching courses:",e),l.fire({icon:"error",title:"Error",text:"Failed to fetch courses",confirmButtonColor:i.palette.primary.main}),L([])}};n.useEffect(()=>{de(),ne()},[M]);const H=()=>{const e={};return(!o.moduleName||o.moduleName.trim()==="")&&(e.moduleName="Enter the module name"),(!o.description||o.description.trim()==="")&&(e.description="Enter the description"),(!o.courseId||o.courseId.length===0)&&(e.courseId="Select at least one course"),(!o.semester||o.semester.length===0)&&(e.semester="Select at least one semester"),(!o.videoUrl||o.videoUrl.trim()==="")&&(e.videoUrl="Enter the video URL"),(!o.url||o.url.trim()==="")&&(e.url="Enter the URL"),e},U=e=>{x({...o,[e.target.name]:e.target.value}),v({...u,[e.target.name]:null})},ue=()=>{W(!1),x({moduleName:"",description:"",courseId:[],videoUrl:"",url:"",fileName:"",semester:[],filePath:null}),T(null),E(!0)},ce=e=>{e.target.files&&e.target.files[0]&&(T(e.target.files[0]),x({...o,fileName:e.target.files[0].name}))},me=async e=>{if(e.preventDefault(),!w){l.fire({icon:"error",title:"No file selected",text:"Please select a file to upload",confirmButtonColor:i.palette.primary.main});return}const a=new FormData;a.append("file",w);try{z(!0),l.fire({title:"Uploading file...",allowOutsideClick:!1,didOpen:()=>{l.showLoading()}});const s=await y.post(`${g}/file/uploadFile`,a,{headers:ie,onUploadProgress:t=>{const m=Math.round(t.loaded*100/t.total);$(m)}});if(l.close(),s.status===200)x({...o,fileName:s.data.fileName,filePath:s.data.filePath}),l.fire({icon:"success",title:"Success!",text:"File uploaded successfully",showConfirmButton:!1,timer:1500});else throw new Error(s.data.errorMessage||"File upload failed")}catch(s){console.error("Error uploading file:",s),l.fire({icon:"error",title:"Upload error",text:s.message||"An error occurred while uploading the file",confirmButtonColor:i.palette.primary.main})}finally{z(!1),$(0)}},fe=async e=>{e.preventDefault();const a=H();if(Object.keys(a).length>0){v(a);return}const s={moduleName:o.moduleName,description:o.description,courseDtoList:o.courseId.map(t=>({courseId:t})),url:o.url,videoUrl:o.videoUrl,fileName:o.fileName,filePath:o.filePath,semester:o.semester,createdBy:{userId:N.userId}};try{const t=await ke(s,I);if(t.data.responseCode===201)l.fire({icon:"success",title:"Success!",text:"Module added successfully",confirmButtonColor:i.palette.primary.main}),S(!M),E(!1);else throw new Error(t.data.errorMessage||"Failed to add module")}catch(t){console.error("Error adding module:",t),l.fire({icon:"error",title:"Error",text:t.message||"Failed to add module",confirmButtonColor:i.palette.primary.main})}},he=async e=>{var a;W(!0),E(!0);try{const s=await Le(e,I);if(!s||!s.data)throw new Error("Invalid API response");const t=s.data;te(t.moduleId),x({moduleName:t.moduleName,description:t.description,courseId:((a=t.courseDtoList)==null?void 0:a.map(m=>m.courseId))||[],url:t.url,videoUrl:t.videoUrl,fileName:t.fileName,filePath:t.filePath,semester:t.semester||[]})}catch(s){console.error("Error fetching module details:",s),l.fire({icon:"error",title:"Error",text:"Failed to fetch module details",confirmButtonColor:i.palette.primary.main})}},pe=async e=>{e.preventDefault();const a=H();if(Object.keys(a).length>0){v(a);return}const s={moduleId:re,moduleName:o.moduleName,description:o.description,courseDtoList:o.courseId.map(t=>({courseId:t})),url:o.url,videoUrl:o.videoUrl,fileName:o.fileName,filePath:o.filePath,updatedBy:{userId:N.userId},semester:o.semester};try{const t=await Ae(s,I);if(t.data.responseCode===200)l.fire({icon:"success",title:"Success!",text:"Module updated successfully",confirmButtonColor:i.palette.primary.main}),S(!M),E(!1);else throw new Error(t.data.errorMessage||"Failed to update module")}catch(t){console.error("Error updating module:",t),l.fire({icon:"error",title:"Error",text:t.message||"Failed to update module",confirmButtonColor:i.palette.primary.main})}},xe=async e=>{if((await l.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#03045E",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{const s=await Oe(e,I);if(s.data.responseCode===200)l.fire({icon:"success",title:"Deleted!",text:"Module has been deleted.",confirmButtonColor:"#03045E"}),S(!M);else throw new Error(s.data.errorMessage||"Failed to delete module")}catch(s){console.error("Error deleting module:",s),l.fire({icon:"error",title:"Error",text:s.message||"Failed to delete module",confirmButtonColor:"#03045E"})}},G=()=>{E(!1),T(null),x({moduleName:"",description:"",courseId:[],videoUrl:"",url:"",fileName:"",filePath:null,semester:[]}),v({})};return r.jsxs(je,{title:r.jsxs(D,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{children:"Modules"}),r.jsxs(P,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px",backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},onClick:ue,children:["Add",r.jsx(ye,{sx:{color:"#fff"}})]})]}),children:[r.jsx(p,{container:!0,spacing:Ce}),r.jsxs(Ie,{sx:{width:"100%",overflow:"hidden"},children:[r.jsx(Ee,{sx:{maxHeight:440},children:r.jsxs(be,{stickyHeader:!0,"aria-label":"sticky table",children:[r.jsx(ve,{children:r.jsx(V,{children:We.map(e=>r.jsx(c,{align:e.align,style:{minWidth:e.minWidth,fontWeight:600,fontSize:15},children:e.label},e.id))})}),r.jsx(Me,{children:A.slice(f*j,f*j+j).map((e,a)=>r.jsxs(V,{hover:!0,role:"checkbox",tabIndex:-1,children:[r.jsx(c,{children:e.moduleId}),r.jsx(c,{children:e.moduleName}),r.jsx(c,{children:e.description}),r.jsx(c,{children:e.courseName}),r.jsx(c,{children:e.semester}),r.jsx(c,{children:e.url}),r.jsx(c,{children:e.videoUrl}),r.jsx(c,{children:e.file}),r.jsx(c,{align:"right",children:e.createdBy}),r.jsx(c,{align:"right",children:e.updatedBy}),r.jsx(c,{align:"right",children:e.insertedDate}),r.jsx(c,{align:"right",children:e.updatedDate}),r.jsxs(c,{align:"right",children:[r.jsx(J,{sx:{color:"#03045E"},onClick:()=>he(e.moduleId),children:r.jsx(Ne,{})}),r.jsx(J,{color:"error",onClick:()=>xe(e.moduleId),children:r.jsx(Ue,{})})]})]},e.moduleId))})]})}),r.jsx(De,{rowsPerPageOptions:[10,25,100],component:"div",count:A.length,rowsPerPage:j,page:f,onPageChange:ae,onRowsPerPageChange:le})]}),r.jsxs(Pe,{open:ee,onClose:G,fullWidth:!0,maxWidth:"md",children:[r.jsx(Be,{sx:{fontSize:"16px"},children:B?"Edit Module":"Add Module"}),r.jsxs(D,{component:"form",onSubmit:B?pe:fe,noValidate:!0,sx:{p:3},children:[r.jsxs(p,{container:!0,spacing:2,children:[r.jsx(p,{item:!0,xs:12,children:r.jsx(b,{fullWidth:!0,label:"Module Name",name:"moduleName",value:o.moduleName,onChange:U,error:!!u.moduleName,helperText:u.moduleName,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),r.jsx(p,{item:!0,xs:12,children:r.jsx(b,{fullWidth:!0,label:"Description",name:"description",value:o.description,onChange:U,error:!!u.description,helperText:u.description,multiline:!0,rows:3,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),r.jsx(p,{item:!0,xs:12,children:r.jsxs(q,{fullWidth:!0,error:!!u.courseId,children:[r.jsx(Y,{children:"Courses"}),r.jsx(K,{name:"courseId",value:o.courseId,onChange:e=>x({...o,courseId:e.target.value}),multiple:!0,renderValue:e=>{var a,s;return((s=(a=C==null?void 0:C.filter(t=>e.includes(t.courseId)))==null?void 0:a.map(t=>t.courseName))==null?void 0:s.join(", "))||"Select courses"},sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}},children:C==null?void 0:C.map(e=>{var a;return r.jsxs(Q,{value:e.courseId,children:[r.jsx(_,{checked:(a=o.courseId)==null?void 0:a.includes(e.courseId)}),e.courseName]},e.courseId)})}),u.courseId&&r.jsx(X,{children:u.courseId})]})}),r.jsx(p,{item:!0,xs:12,children:r.jsxs(q,{fullWidth:!0,error:!!u.semester,children:[r.jsx(Y,{children:"Semester"}),r.jsx(K,{name:"semester",value:o.semester||[],onChange:e=>x({...o,semester:e.target.value}),multiple:!0,renderValue:e=>(e==null?void 0:e.length)>0?e.join(", "):"Select semester",sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}},children:[1,2,3,4,5,6].map(e=>{var a;return r.jsxs(Q,{value:e,children:[r.jsx(_,{checked:(a=o.semester)==null?void 0:a.includes(e)}),e]},e)})}),u.semester&&r.jsx(X,{children:u.semester})]})}),r.jsx(p,{item:!0,xs:12,children:r.jsx(b,{fullWidth:!0,label:"URL",name:"url",value:o.url,onChange:U,error:!!u.url,helperText:u.url,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),r.jsx(p,{item:!0,xs:12,children:r.jsx(b,{fullWidth:!0,label:"Video URL",name:"videoUrl",value:o.videoUrl,onChange:U,error:!!u.videoUrl,helperText:u.videoUrl,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),r.jsxs(p,{item:!0,xs:12,children:[r.jsx(b,{fullWidth:!0,label:"File Name",name:"fileName",value:o.fileName,disabled:!0,InputProps:{endAdornment:r.jsx(P,{variant:"contained",onClick:me,disabled:!w||F,sx:{backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9},"&:disabled":{backgroundColor:"#f5f5f5"}},children:"Upload"})}}),r.jsx("input",{type:"file",ref:oe,onChange:ce,style:{marginTop:"10px"},accept:"*/*"}),F&&r.jsxs(D,{sx:{width:"100%",mt:1},children:[r.jsx(Se,{variant:"determinate",value:R}),r.jsx(D,{sx:{display:"flex",justifyContent:"flex-end"},children:r.jsxs("span",{children:[R,"%"]})})]})]})]}),r.jsxs(we,{children:[r.jsx(P,{onClick:G,sx:{color:"#03045E"},children:"Cancel"}),r.jsx(P,{type:"submit",variant:"contained",disabled:F,sx:{backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},children:B?"Update":"Save"})]})]})]})]})};export{$e as default};
