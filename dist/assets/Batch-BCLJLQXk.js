import{v as p,c as f,S as h,d as le,r as n,j as t,M as ne,B as w,b as M,e as de,G as I,g as ie,P as ue,f as he,h as ge,i as me,k as W,l as A,m as pe,I as O,E as fe,D as be,n as xe,o as Ie,p as ye,q as $,F,A as U,H as z,J as G,Q as Ce,s as je,t as H}from"./index-D1P8NqU1.js";const Ne=async c=>await p({method:"GET",url:`${f}/batch/v1/getAllBatchByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10`,headers:c}),De=async(c,u)=>await p({method:"GET",url:`${f}/batch/v1/getBatchByBatchId/{batchId}?batchId=${c}`,headers:u}),Ee=async c=>await p({method:"GET",url:`${f}/course/v1/queryAllCourses`,headers:c}),Be=async c=>await p({method:"GET",url:`${f}/college/v1/getAllColleges`,headers:c}),Se=async(c,u)=>await p({method:"PUT",url:`${f}/batch/v1/updateBatch`,headers:u,data:c}).then(s=>{console.log(s),s.data.responseCode===201?h.fire("Success",s.data.message,"success"):s.data.responseCode===400&&h.fire("Error",s.data.errorMessage,"error")}).catch(s=>{console.log(s),h.fire("Error",s.message||"Something went wrong","error")}),ve=async(c,u)=>{try{return await p({method:"POST",url:`${f}/batch/v1/createBatch`,headers:u,data:JSON.stringify(c)}).then(s=>{s.data.responseCode===201?h.fire("Success",s.data.message,"success"):s.data.responseCode===400&&h.fire("Error",s.data.errorMessage,"error")})}catch(s){h.fire("Error",s.message||"Something went wrong","error")}},we=async(c,u)=>await p({method:"DELETE",url:`${f}/batch/v1/deleteBatchById/${c}`,headers:u}).then(s=>{s.data.responseCode===200?h.fire("Deleted",s.data.message,"success"):s.data.responseCode===400&&h.fire("Error",s.data.errorMessage,"error")}).catch(s=>{var j,b;console.log(s),h.fire("Error",((b=(j=s.response)==null?void 0:j.data)==null?void 0:b.errorMessage)||"Something went wrong","error")}),R=[{id:"batchId",label:"ID"},{id:"batchName",label:"Name",minWidth:100},{id:"description",label:"Description",minWidth:100},{id:"collegeName",label:"College ",minWidth:100},{id:"courseName",label:"Course ",minWidth:200},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],Pe=()=>{le();const[c,u]=n.useState(0),[s,j]=n.useState(10),[b,J]=n.useState([]),[q,V]=n.useState([]),[T,P]=n.useState([]),[Q,g]=n.useState(!1),[N,D]=n.useState(!1),[o,y]=n.useState({batchName:"",description:"",courseId:"",collegeId:""}),[i,E]=n.useState({}),[B,k]=n.useState(!1),[_,K]=n.useState(null),[Me,X]=n.useState([]),Y=(e,a)=>{u(a)},Z=e=>{j(+e.target.value),u(0)},S=JSON.parse(sessionStorage.getItem("user")),m={"Content-type":"application/json",Authorization:"Bearer "+S.accessToken},x=async()=>{try{const a=(await Ne(m)).data.content;if(a){const l=a.map(r=>{var d;return{batchId:r.batchId,batchName:r.batchName,description:r.description,courseName:((d=r.courseDtoList)==null?void 0:d.map(C=>C.courseName).join(", "))||"No course",collegeName:r.collegeDto?r.collegeDto.collegeName:"No College Name",insertedDate:H(r.insertedDate).format("L"),updatedDate:H(r.updatedDate).format("L"),createdBy:r.createdBy?r.createdBy.userName:"No User",updatedBy:r.updatedBy?r.updatedBy.userName:"No User"}});P(l)}else P([])}catch(e){console.error("Error fetching batches:",e)}},ee=async()=>{try{const a=(await Ee(m)).data;if(a){const r=a.sort((d,C)=>d.courseName.localeCompare(C.courseName)).map(d=>({courseId:d.courseId,courseName:d.courseName}));J(r)}}catch(e){console.error("Error fetching courses:",e)}},te=async()=>{try{const e=await Be(m),a=e.data;if(console.log(e.data),a){const r=a.sort((d,C)=>d.collegeName.localeCompare(C.collegeName)).map(d=>({collegeId:d.collegeId,collegeName:d.collegeName}));V(r)}}catch(e){console.error("Error fetching colleges:",e)}};n.useEffect(()=>{x(),ee(),te()},[B]);const L=()=>{const e={};return(!o.batchName||o.batchName.trim()==="")&&(e.batchName="Enter the module name"),(!o.description||o.description.trim()==="")&&(e.description="Enter the description"),o.courseId||(e.courseId="Select a course"),o.collegeId||(e.collegeId="Select a college"),e},v=e=>{y({...o,[e.target.name]:e.target.value}),E({...i,[e.target.name]:null})},ae=()=>{D(!1),y({batchName:"",description:"",courseId:"",collegeId:""}),g(!0)},re=async e=>{e.preventDefault();const a=L();if(Object.keys(a).length>0){E(a);return}const l={batchName:o.batchName,description:o.description,courseDtoList:b.filter(r=>r.courseId===o.courseId).map(r=>({courseId:r.courseId,courseName:r.courseName})),collegeDto:o.collegeId,createdBy:{userId:S.userId}};console.log(l);try{const r=await ve(l,m);r.data.responseCode===201?(k(!B),g(!1),x()):alert(r.data.errorMessage||"Failed to add batch.")}catch{}x(),g(!1)},se=async e=>{D(!0),g(!0);try{const l=(await De(e,m)).data;y({batchName:l.batchName,description:l.description,courseId:l.courseDtoList?l.courseDtoList.map(r=>r.courseId):[],collegeId:l.collegeDto?l.collegeDto.collegeId:""})}catch(a){console.error("Error fetching batch details:",a)}},oe=async e=>{e.preventDefault();const a=L();if(Object.keys(a).length>0){E(a);return}const l={batchId:_,batchName:o.batchName,description:o.description,courseDtoList:o.courseId.map(r=>({courseId:r})),collegeDto:{collegeId:o.collegeId},updatedBy:{userId:S.userId}};console.log(l);try{const r=await Se(l,m);r.data.responseCode===201?(k(!B),g(!1),D(!1),K(null),y({batchName:"",description:"",courseId:"",collegeId:""}),X([]),x()):alert(r.data.errorMessage)}catch{}x()},ce=async e=>{try{await we(e,m),x()}catch(a){console.error("Error deleting batch:",a)}};return t.jsxs(ne,{title:t.jsxs(w,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{children:" Batch"}),t.jsxs(M,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px",backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},onClick:ae,children:["Add",t.jsx(de,{sx:{color:"#fff"}})]})]}),children:[t.jsx(I,{container:!0,spacing:ie}),t.jsxs(ue,{sx:{width:"100%",overflow:"hidden"},children:[t.jsx(he,{sx:{maxHeight:440},children:t.jsxs(ge,{stickyHeader:!0,"aria-label":"sticky table",children:[t.jsx(me,{children:t.jsx(W,{children:R.map(e=>t.jsx(A,{align:e.align,style:{minWidth:e.minWidth,fontWeight:600,fontSize:15},children:e.label},e.id))})}),t.jsx(pe,{children:T.slice(c*s,c*s+s).map(e=>t.jsx(W,{hover:!0,role:"checkbox",tabIndex:-1,children:R.map(a=>t.jsx(A,{align:a.align,children:a.id==="actions"?t.jsxs(t.Fragment,{children:[t.jsx(O,{sx:{color:"#03045E"},onClick:()=>{se(e.batchId)},children:t.jsx(fe,{})}),t.jsx(O,{color:"error",onClick:()=>{ce(e.batchId)},children:t.jsx(be,{})})]}):e[a.id]||"No Data"},a.id))},e.batchId))})]})}),t.jsx(xe,{rowsPerPageOptions:[10,25,100],component:"div",count:T.length,rowsPerPage:s,page:c,onPageChange:Y,onRowsPerPageChange:Z})]}),t.jsxs(Ie,{open:Q,onClose:()=>g(!1),fullWidth:!0,maxWidth:"md",children:[t.jsx(ye,{sx:{fontSize:"16px"},children:N?"Edit Batch":"Add Batch"}),t.jsxs(w,{component:"form",onSubmit:N?oe:re,noValidate:!0,sx:{p:3},children:[t.jsxs(I,{container:!0,spacing:2,children:[t.jsx(I,{item:!0,xs:12,children:t.jsx($,{fullWidth:!0,label:"Batch Name",name:"batchName",value:o.batchName,onChange:v,error:!!i.batchName,helperText:i.batchName,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),t.jsx(I,{item:!0,xs:12,children:t.jsx($,{fullWidth:!0,label:"Description",name:"description",value:o.description,onChange:v,error:!!i.description,helperText:i.description,multiline:!0,rows:3,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),t.jsx(I,{item:!0,xs:12,children:t.jsxs(F,{fullWidth:!0,error:!!i.collegeId,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}},children:[t.jsx(U,{children:"College"}),t.jsx(z,{name:"collegeId",value:o.collegeId,onChange:v,children:q.map(e=>t.jsx(G,{value:e.collegeId,children:e.collegeName},e.collegeId))}),i.collegeId&&t.jsx(FormHelperText,{children:i.collegeId})]})}),t.jsx(I,{item:!0,xs:12,children:t.jsxs(F,{fullWidth:!0,error:!!i.courseId,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}},children:[t.jsx(U,{children:"Courses"}),t.jsx(z,{name:"courseId",value:o.courseId||[],onChange:e=>y({...o,courseId:e.target.value}),multiple:!0,renderValue:e=>b.filter(a=>e.includes(a.courseId)).map(a=>a.courseName).join(", ")||"Select courses",children:b.map(e=>{var a;return t.jsxs(G,{value:e.courseId,children:[t.jsx(Ce,{checked:(a=o.courseId)==null?void 0:a.includes(e.courseId)}),e.courseName]},e.courseId)})}),i.courseId&&t.jsx(w,{sx:{color:"red",fontSize:"0.75rem",mt:1},children:i.courseId})]})})]}),t.jsxs(je,{children:[t.jsx(M,{onClick:()=>g(!1),sx:{color:"#03045E"},children:"Cancel"}),t.jsx(M,{type:"submit",variant:"contained",sx:{backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},children:N?"Update":"Save"})]})]})]})]})};export{Pe as default};
