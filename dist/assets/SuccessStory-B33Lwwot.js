import{d as ee,r as o,j as e,M as te,x as P,b as m,e as se,G as u,g as ae,P as re,f as oe,h as ne,i as ie,k as B,l as k,m as ce,I as T,n as le,o as de,p as ue,q as x,s as he,t as F,v as pe,c as M,S as U}from"./index-D1P8NqU1.js";import{d as me,a as ge}from"./DeleteForever-DfHvKCdO.js";import{f as fe,d as xe,g as ye,u as Ne,a as be}from"./SuccessStoryApi-Eakrx0rb.js";const A=[{id:"successstoryId",label:"ID",align:"center"},{id:"successstoryName",label:"Name",align:"center"},{id:"description",label:"Description",minWidth:100,align:"center"},{id:"file",label:"File",align:"center"},{id:"createdBy",label:"Created By",align:"center"},{id:"updatedBy",label:"Updated By",align:"center"},{id:"insertedDate",label:"Inserted Date",align:"center"},{id:"updatedDate",label:"Updated Date",align:"center"},{id:"actions",label:"Actions",align:"center"}],we=()=>{ee();const[g,y]=o.useState(0),[h,W]=o.useState(10),[N,b]=o.useState([]),[f,j]=o.useState(!1),[O,c]=o.useState(!1),[R,$]=o.useState(null),[je,S]=o.useState(""),[i,E]=o.useState({}),[I,z]=o.useState(null),C=o.useRef(null),[Se,w]=o.useState(""),[H,D]=o.useState(!1),[n,l]=o.useState({successstoryName:"",description:""}),L=(t,s)=>{y(s)},G=t=>{W(+t.target.value),y(0)},p=JSON.parse(sessionStorage.getItem("user")),d={"Content-type":"application/json",Authorization:`Bearer ${p.accessToken}`},_=`${M}/file/downloadFile/?filePath=`,q=async()=>{try{const s=(await fe(d)).data.content;if(s){const a=s.map(r=>({successstoryId:r.successstoryId,successstoryName:r.successstoryName,description:r.description,file:r.photoPath?e.jsx("img",{src:_+r.photoPath,alt:r.photoName,style:{width:100,height:50}}):"NO IMAGE FOUND",insertedDate:F(r.insertedDate).format("L"),updatedDate:F(r.updatedDate).format("L"),createdBy:r.createdBy?r.createdBy.userName:"No User",updatedBy:r.updatedBy?r.updatedBy.userName:"No User"}));b(a)}else b([])}catch(t){console.error("Error fetching data:",t)}};o.useEffect(()=>{q()},[H]);const J=()=>{const t={};return n.successstoryName.trim()||(t.successstoryName="Enter the News"),n.description.trim()||(t.description="Enter the Description"),(!n.photoName||n.photoName.trim()==="")&&(t.photoName="Select the file"),t},v=t=>{l({...n,[t.target.name]:t.target.value}),E(s=>({...s,[t.target.name]:null}))},V=async t=>{try{await xe(t,d),D(s=>!s)}catch(s){console.error("Error deleting news:",s)}},K=async t=>{j(!0),c(!0);try{const a=(await ye(t,d)).data;$(a.successstoryId),l({successstoryName:a.successstoryName,description:a.description,photoName:a.photoName})}catch(s){console.error("Error fetching news by ID:",s)}},Q=async t=>{if(t.preventDefault(),!I){w("Please select a file");return}const s=new FormData;s.append("file",I);try{const a=await pe.post(`${M}/file/uploadFile`,s,{headers:{"content-type":"multipart/form-data",Authorization:`Bearer ${p.accessToken}`}});S(a.data.fileName),l(r=>({...r,photoName:a.data.fileName})),w(""),U.fire({target:document.getElementById("your-dialog-id"),icon:"success",title:"Upload Successful",text:a.data.message||"File uploaded successfully!"}),console.log(a.data)}catch(a){console.error("Error uploading file:",a),U.fire({icon:"error",title:"Upload Failed",text:"Something went wrong while uploading the file."})}},X=t=>{S(t.target.files[0].name),z(t.target.files[0])},Y=async t=>{t.preventDefault();const s=J();if(console.log(n),Object.keys(s).length>0)E(s);else try{if(f){const a={...n,successstoryId:R,updatedBy:{userId:p.userId}};await Ne(a,d)}else{const a={...n,createdBy:{userId:p.userId}};await be(a,d)}l({successstoryName:"",description:"",photoName:""}),C.current.value=null,D(a=>!a),c(!1)}catch(a){console.error("Error saving news:",a)}},Z=()=>{j(!1),l({successstoryName:"",description:"",photoName:""}),c(!0)};return e.jsxs(te,{title:e.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"SuccessStory"}),e.jsxs(m,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px",backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},onClick:Z,children:["Add",e.jsx(se,{sx:{color:"#fff"}})]})]}),children:[e.jsx(u,{container:!0,spacing:ae}),e.jsxs(re,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(oe,{sx:{maxHeight:440},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(ie,{children:e.jsx(B,{children:A.map(t=>e.jsx(k,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(ce,{children:N.slice(g*h,g*h+h).map(t=>e.jsx(B,{hover:!0,role:"checkbox",tabIndex:-1,children:A.map(s=>e.jsx(k,{align:s.align,children:s.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(T,{onClick:()=>K(t.successstoryId),sx:{color:"#03045E"},children:e.jsx(me,{})}),e.jsx(T,{onClick:()=>V(t.successstoryId),color:"error",children:e.jsx(ge,{})})]}):t[s.id]},s.id))},t.successstoryId))})]})}),e.jsx(le,{rowsPerPageOptions:[10,25,100],component:"div",count:N.length,rowsPerPage:h,page:g,onPageChange:L,onRowsPerPageChange:G})]}),e.jsxs(de,{open:O,onClose:()=>c(!1),fullWidth:!0,maxWidth:"md",id:"your-dialog-id",children:[e.jsx(ue,{sx:{fontSize:"16px"},children:f?"Edit SuccessStory":"Add SuccessStory"}),e.jsxs(P,{component:"form",onSubmit:Y,noValidate:!0,sx:{p:3},children:[e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"SuccessStory Name",name:"successstoryName",value:n.successstoryName,onChange:v,error:!!i.successstoryName,helperText:i.successstoryName,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"Description",name:"description",value:n.description,onChange:v,error:!!i.description,helperText:i.description,multiline:!0,rows:3,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(x,{margin:"normal",fullWidth:!0,id:"photoName",label:"File Name",name:"photoName",autoComplete:"photoName",value:n.photoName,disabled:!0,helperText:i.photoName,error:!!i.photoName,InputProps:{endAdornment:e.jsx(m,{variant:"contained",sx:{backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},onClick:Q,children:"Upload"})}}),e.jsx("input",{type:"file",onChange:X,ref:C,style:{marginTop:20}})]})]}),e.jsxs(he,{children:[e.jsx(m,{onClick:()=>c(!1),sx:{color:"#03045E"},children:"Cancel"}),e.jsx(m,{type:"submit",variant:"contained",sx:{backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},children:f?"Update":"Save"})]})]})]})]})};export{we as default};
