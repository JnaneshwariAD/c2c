import{v as x,c as b,S as u,d as Z,r as c,j as r,M as ee,B as O,b as M,e as re,G as g,g as te,P as ae,f as ne,h as se,i as ie,k as L,l as W,m as oe,I as F,E as ce,D as de,n as le,o as ue,p as he,q as T,F as me,A as fe,H as pe,J as ye,Q as ge,s as xe,t as $}from"./index-D1P8NqU1.js";const be=async o=>await x({method:"GET",url:`${b}/branch/v1/getAllBranchByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10`,headers:o}),ve=async o=>await x({method:"GET",url:`${b}/university/v1/getAllUniversitys`,headers:o}),Ie=async(o,d)=>await x({method:"GET",url:`${b}/branch/v1/queryBranchByBranchId/${o}`,headers:d}),je=async(o,d)=>{try{const n=await x({method:"POST",url:`${b}/branch/v1/createBranch`,headers:d,data:o});return n.data.responseCode===201?u.fire({icon:"success",title:"Success",text:n.data.message||"Branch created successfully!"}):n.data.responseCode===400&&u.fire({icon:"error",title:"Error",text:n.data.errorMessage||"Something went wrong"}),n}catch(n){u.fire({icon:"error",title:"Error",text:n.message||"An unexpected error occurred"})}},Be=async(o,d)=>{try{const n=await x({method:"PUT",url:`${b}/branch/v1/updateBranch`,headers:d,data:o});return n.data.responseCode===201?u.fire({icon:"success",title:"Updated",text:n.data.message||"Branch updated successfully!"}):n.data.responseCode===400&&u.fire({icon:"error",title:"Error",text:n.data.errorMessage||"Update failed"}),n}catch(n){u.fire({icon:"error",title:"Error",text:n.message||"An error occurred while updating"})}},Se=async(o,d)=>{var n,j;try{if((await u.fire({title:"Are you sure?",text:"This will permanently delete the branch!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"})).isConfirmed){const m=await x({method:"DELETE",url:`${b}/branch/v1/deleteBranchByBranchId/${o}`,headers:d});return m.data.responseCode===200?u.fire({icon:"success",title:"Deleted!",text:m.data.message||"Branch deleted successfully!"}):m.data.responseCode===400&&u.fire({icon:"error",title:"Error",text:m.data.errorMessage||"Deletion failed!"}),m}else return null}catch(h){return u.fire({icon:"error",title:"Error",text:((j=(n=h==null?void 0:h.response)==null?void 0:n.data)==null?void 0:j.errorMessage)||h.message||"An unexpected error occurred"}),null}},z=[{id:"branchId",label:"ID",align:"center"},{id:"branchName",label:"Name",align:"center"},{id:"description",label:"Description",minWidth:100,align:"center"},{id:"universityName",label:"University",align:"center"},{id:"noOfSem",label:"Sem",align:"center"},{id:"createdBy",label:"Created By",align:"center"},{id:"updatedBy",label:"Updated By",align:"center"},{id:"insertedDate",label:"Inserted Date",align:"center"},{id:"updatedDate",label:"Updated Date",align:"center"},{id:"actions",label:"Actions",align:"center"}],Ee=()=>{Z();const[o,d]=c.useState(0),[n,j]=c.useState(10),[h,m]=c.useState([]),[P,R]=c.useState([]),[G,f]=c.useState(!1),[B,S]=c.useState(!1),[s,v]=c.useState({branchName:"",description:"",noOfSem:""}),[l,C]=c.useState({}),[E,k]=c.useState(!1),[H,U]=c.useState(null),q=(e,t)=>{d(t)},J=e=>{j(+e.target.value),d(0)},D=JSON.parse(sessionStorage.getItem("user")),y={"Content-type":"application/json",Authorization:"Bearer "+D.accessToken},I=async()=>{try{const t=(await be(y)).data.content;if(console.log(t),t){const i=t.map(a=>{var p;return{branchId:a.branchId,branchName:a.branchName,description:a.description,universityName:((p=a.universityDtoList)==null?void 0:p.map(w=>w.universityName).join(", "))||"No university",noOfSem:a.noOfSem,insertedDate:$(a.insertedDate).format("L"),updatedDate:$(a.updatedDate).format("L"),createdBy:a.createdBy?a.createdBy.userName:"No User",updatedBy:a.updatedBy?a.updatedBy.userName:"No User"}});m(i)}else m([])}catch(e){console.error("Error fetching data:",e)}},V=async()=>{try{const t=(await ve(y)).data;if(t){const a=t.sort((p,w)=>p.universityName.localeCompare(w.universityName)).map(p=>({universityId:p.universityId,universityName:p.universityName}));R(a)}}catch(e){console.error("Error fetching univeristies:",e)}};c.useEffect(()=>{I(),V()},[E]);const A=()=>{const e={};return(!s.branchName||s.branchName.trim()==="")&&(e.branchName="Enter the branch name"),(!s.description||s.description.trim()==="")&&(e.description="Enter the description"),(!s.noOfSem||isNaN(s.noOfSem))&&(e.noOfSem="Number of semesters is required and must be a valid number."),s.universityId||(e.universityId="Select a univeristy"),e},N=e=>{v({...s,[e.target.name]:e.target.value}),C({...l,[e.target.name]:null})},Q=()=>{S(!1),v({branchId:"",branchName:"",description:"",noOfSem:""}),f(!0)},Y=async e=>{e.preventDefault();const t=A();if(Object.keys(t).length>0){C(t);return}const i={...s,universityDtoList:s.universityId.map(a=>({universityId:a})),createdBy:{userId:D.userId}};console.log(i);try{const a=await je(i,y);a.data.responseCode===201?(k(!E),f(!1),I()):alert(a.data.errorMessage||"Failed to add branch.")}catch{}f(!1),I()},_=async e=>{S(!0),f(!0);try{const i=(await Ie(e,y)).data;console.log(i),U(i.branchId),v({branchName:i.branchName,description:i.description,noOfSem:i.noOfSem,universityId:i.universityDtoList?i.universityDtoList.map(a=>a.universityId):[]})}catch(t){console.error("Error fetching branch details:",t)}},K=async e=>{e.preventDefault();const t=A();if(Object.keys(t).length>0){C(t);return}const i={branchId:H,branchName:s.branchName,description:s.description,noOfSem:s.noOfSem,universityDtoList:s.universityId.map(a=>({universityId:a})),updatedBy:{userId:D.userId}};console.log(i);try{const a=await Be(i,y);console.log(a),a&&a.data.responseCode===201&&(k(!E),f(!1),S(!1),U(null),v({branchName:"",description:"",noOfSem:"",universityDtoList:[]}))}catch(a){console.error("Error updating branch:",a)}finally{I(),f(!1)}},X=async e=>{try{await Se(e,y),I()}catch(t){console.error("Error deleting branch:",t)}};return r.jsxs(ee,{title:r.jsxs(O,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{children:"Branch"}),r.jsxs(M,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px",backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},onClick:Q,children:["Add",r.jsx(re,{sx:{color:"#fff"}})]})]}),children:[r.jsx(g,{container:!0,spacing:te}),r.jsxs(ae,{sx:{width:"100%",overflow:"hidden"},children:[r.jsx(ne,{sx:{maxHeight:440},children:r.jsxs(se,{stickyHeader:!0,"aria-label":"sticky table",children:[r.jsx(ie,{children:r.jsx(L,{children:z.map(e=>r.jsx(W,{align:e.align,style:{minWidth:e.minWidth,fontWeight:600,fontSize:15},children:e.label},e.id))})}),r.jsx(oe,{children:h.slice(o*n,o*n+n).map(e=>r.jsx(L,{hover:!0,role:"checkbox",tabIndex:-1,children:z.map(t=>r.jsx(W,{align:t.align,children:t.id==="actions"?r.jsxs(r.Fragment,{children:[r.jsx(F,{sx:{color:"#03045E"},onClick:()=>{_(e.branchId)},children:r.jsx(ce,{})}),r.jsx(F,{color:"error",onClick:()=>{X(e.branchId)},children:r.jsx(de,{})})]}):e[t.id]},t.id))},e.branchId))})]})}),r.jsx(le,{rowsPerPageOptions:[10,25,100],component:"div",count:h.length,rowsPerPage:n,page:o,onPageChange:q,onRowsPerPageChange:J})]}),r.jsxs(ue,{open:G,onClose:()=>f(!1),fullWidth:!0,maxWidth:"md",children:[r.jsx(he,{sx:{fontSize:"16px"},children:B?"Edit Branch":"Add Branch"}),r.jsxs(O,{component:"form",onSubmit:B?K:Y,noValidate:!0,sx:{p:3},children:[r.jsxs(g,{container:!0,spacing:2,children:[r.jsx(g,{item:!0,xs:12,children:r.jsx(T,{fullWidth:!0,label:"Branch Name",name:"branchName",value:s.branchName,onChange:N,error:!!l.branchName,helperText:l.branchName,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),r.jsx(g,{item:!0,xs:12,children:r.jsx(T,{fullWidth:!0,label:"Description",name:"description",value:s.description,onChange:N,error:!!l.description,helperText:l.description,multiline:!0,rows:3,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),r.jsx(g,{item:!0,xs:12,children:r.jsxs(me,{fullWidth:!0,error:!!l.universityId,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}},children:[r.jsx(fe,{children:"University"}),r.jsx(pe,{name:"universityId",value:s.universityId||[],onChange:e=>v({...s,universityId:e.target.value}),multiple:!0,renderValue:e=>P.filter(t=>e.includes(t.universityId)).map(t=>t.universityName).join(", ")||"Select Universities",children:P.map(e=>{var t;return r.jsxs(ye,{value:e.universityId,children:[r.jsx(ge,{checked:(t=s.universityId)==null?void 0:t.includes(e.universityId)}),e.universityName]},e.universityId)})}),l.universityId&&r.jsx(O,{sx:{color:"red",fontSize:"0.75rem",mt:1},children:l.universityId})]})}),r.jsx(g,{item:!0,xs:12,children:r.jsx(T,{fullWidth:!0,label:"Sem",name:"noOfSem",value:s.noOfSem,onChange:N,error:!!l.noOfSem,helperText:l.noOfSem,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})})]}),r.jsxs(xe,{children:[r.jsx(M,{onClick:()=>f(!1),sx:{color:"#03045E"},children:"Cancel"}),r.jsx(M,{type:"submit",variant:"contained",sx:{backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},children:B?"Update":"Save"})]})]})]})]})};export{Ee as default};
