import{v as y,c as g,S as d,d as ie,r as n,j as e,M as le,B as L,b as T,e as de,f as ne,P as ce,h as ue,i as me,k as A,l as u,m as pe,I as O,E as he,D as fe,n as ge,o as xe,p as ye,G as x,q as E,F as je,A as Ie,H as be,J as Ne,K as Ee,s as ve,t as W}from"./index-D1P8NqU1.js";const Ce=async l=>await y({method:"GET",url:`${g}/topic/v1/getAllTopicByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10`,headers:l}),Te=async(l,m)=>{try{const i=await y({method:"POST",url:`${g}/topic/v1/createTopic`,headers:m,data:l});i.data.responseCode===201?d.fire("Success",i.data.message,"success"):i.data.responseCode===400&&d.fire("Error",i.data.errorMessage,"error")}catch(i){d.fire("Error",i.message||"Something went wrong","error")}},De=async(l,m)=>await y({method:"GET",url:`${g}/topic/v1/getTopicById/{topicId}?topicId=${l}`,headers:m}),Me=async l=>await y({method:"GET",url:`${g}/module/v1/queryAllModules`,headers:l}),Ue=async(l,m)=>{console.log(l);try{const i=await y({method:"PUT",url:`${g}/topic/v1/updateTopic`,headers:m,data:l});console.log(i),i.data.responseCode===201?d.fire("Success",i.data.message,"success"):i.data.responseCode===400&&d.fire("Error",i.data.errorMessage,"error")}catch(i){console.log(i),d.fire("Error",i.message||"Update failed","error")}},we=async(l,m)=>{var i,h;try{const p=await y({method:"DELETE",url:`${g}/topic/v1/deleteTopicById/${l}`,headers:m});p.data.responseCode===200?d.fire("Deleted",p.data.message,"success"):p.data.responseCode===400&&d.fire("Error",p.data.errorMessage,"error")}catch(p){console.log(p),d.fire("Error",((h=(i=p.response)==null?void 0:i.data)==null?void 0:h.errorMessage)||"Delete failed","error")}},Se=[{id:"topicId",label:"ID"},{id:"topicName",label:"Name",minWidth:150},{id:"description",label:"Description",minWidth:400},{id:"moduleName",label:"Module",minWidth:150},{id:"url",label:"Url"},{id:"videoUrl",label:"VideoUrl"},{id:"file",label:"File",minWidth:200},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],Fe=()=>{const l=ie(),[m,i]=n.useState(0),[h,p]=n.useState(10),[w,S]=n.useState([]),[R,$]=n.useState([]),[z,f]=n.useState(!1),[D,B]=n.useState(!1),[a,v]=n.useState({topicName:"",description:"",moduleId:"",videoUrl:"",url:"",fileName:""}),[c,M]=n.useState({}),[C,U]=n.useState(!1),[G,H]=n.useState(null),[Be,P]=n.useState(""),[Pe,V]=n.useState(""),[k,q]=n.useState(null),J=n.useRef(null),I=JSON.parse(sessionStorage.getItem("user")),j={"Content-type":"application/json",Authorization:"Bearer "+I.accessToken},K=`${g}/file/downloadFile/?filePath=`,b=async()=>{try{const r=(await Ce(j)).data.content;if(r){const s=r.map(o=>({topicId:o.topicId,topicName:o.topicName,description:o.description,moduleName:o.moduleDtoList?o.moduleDtoList.moduleName:"No Module Name",url:o.url,videoUrl:o.videoUrl,file:o.filePath===null?"NO FILE FOUND":e.jsx("img",{src:K+o.filePath,alt:o.fileName,style:{width:100,height:50}}),insertedDate:W(o.insertedDate).format("L"),updatedDate:W(o.updatedDate).format("L"),createdBy:o.createdBy?o.createdBy.userName:"No User",updatedBy:o.updatedBy?o.updatedBy.userName:"No User"}));S(s)}else S([])}catch(t){console.error("Error fetching topics:",t)}},_=async()=>{try{const r=(await Me(j)).data;if(r){const s=r.sort((o,se)=>o.moduleName.localeCompare(se.moduleName));$(s)}}catch(t){console.error("Error fetching modules:",t)}};n.useEffect(()=>{b(),_()},[C]);const F=()=>{const t={};return(!a.topicName||a.topicName.trim()==="")&&(t.topicName="Enter the topic name"),(!a.description||a.description.trim()==="")&&(t.description="Enter the description"),(!a.videoUrl||a.videoUrl.trim()==="")&&(t.videoUrl="Enter the video URL"),(!a.url||a.url.trim()==="")&&(t.url="Enter the URL"),a.moduleId||(t.moduleId="Select a module"),(!a.fileName||a.fileName.trim()==="")&&(t.fileName="Select the file"),t},N=t=>{v({...a,[t.target.name]:t.target.value,createdBy:{userId:I.userId}}),M({...c,[t.target.name]:null})},Q=()=>{B(!1),v({topicName:"",description:"",moduleId:"",videoUrl:"",url:"",fileName:""}),f(!0)},X=t=>{const r=t.target.files[0];q(r),V(r?r.name:"")},Y=async t=>{if(t.preventDefault(),!k){P("Please select a file"),d.fire({icon:"error",title:"No file selected",text:"Please select a file to upload",confirmButtonColor:l.palette.primary.main});return}const r=new FormData;r.append("file",k);try{d.fire({title:"Uploading file...",allowOutsideClick:!1,didOpen:()=>{d.showLoading()}});const s=await y.post(`${g}/file/uploadFile`,r,{headers:{"content-type":"multipart/form-data",Authorization:"Bearer "+I.accessToken}});d.close(),s.status===200?(v(o=>({...o,fileName:s.data.fileName})),P(""),d.fire({icon:"success",title:"Success!",text:s.data.message,showConfirmButton:!1,timer:1500,background:l.palette.background.default,color:l.palette.text.primary})):d.fire({icon:"error",title:"Upload failed",text:s.data.errorMessage,confirmButtonColor:l.palette.primary.main})}catch(s){console.log("Error uploading file:",s),d.fire({icon:"error",title:"Upload error",text:"An error occurred while uploading the file",confirmButtonColor:l.palette.primary.main})}},Z=async t=>{t.preventDefault();const r=F();if(Object.keys(r).length>0){M(r);return}const s={...a,moduleDtoList:{moduleId:a.moduleId},createdBy:{userId:I.userId}};try{const o=await Te(s,j);o.data.responseCode===201?(U(!C),f(!1),b()):alert(o.data.errorMessage)}catch(o){console.error("Error posting topic:",o)}b(),f(!1)},ee=async t=>{B(!0),f(!0);try{const s=(await De(t,j)).data;H(s.topicId),v({topicName:s.topicName,description:s.description,url:s.url,videoUrl:s.videoUrl,fileName:s.fileName,moduleId:s.moduleDtoList?s.moduleDtoList.moduleId:""})}catch(r){console.error("Error fetching topic details:",r)}},te=async t=>{t.preventDefault();const r=F();if(Object.keys(r).length>0){M(r);return}const s={topicId:G,topicName:a.topicName,description:a.description,url:a.url,videoUrl:a.videoUrl,fileName:a.fileName,moduleDtoList:{moduleId:a.moduleId},updatedBy:{userId:I.userId}};try{const o=await Ue(s,j);o.data.responseCode===200?(alert(o.data.message),U(!C),f(!1)):alert(o.data.errorMessage)}catch(o){console.error("Error updating topic:",o)}b(),f(!1)},re=async t=>{if(window.confirm("Are you sure you want to delete this topic?"))try{const r=await we(t,j);r.data.responseCode===200?(alert(r.data.message),U(!C),b()):alert(r.data.errorMessage)}catch(r){console.error("Error deleting topic:",r)}},oe=(t,r)=>{i(r)},ae=t=>{p(parseInt(t.target.value,10)),i(0)};return e.jsxs(e.Fragment,{children:[e.jsxs(le,{title:e.jsxs(L,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"Topic"}),e.jsxs(T,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px",backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},onClick:Q,children:["Add",e.jsx(de,{sx:{color:"#fff"}})]})]}),children:[e.jsx(ne,{component:ce,children:e.jsxs(ue,{sx:{minWidth:650},"aria-labelledby":"tableTitle",children:[e.jsx(me,{children:e.jsx(A,{children:Se.map(t=>e.jsx(u,{align:t.align,style:{minWidth:t.minWidth},children:t.label},t.id))})}),e.jsx(pe,{children:w.slice(m*h,m*h+h).map((t,r)=>e.jsxs(A,{hover:!0,role:"checkbox",tabIndex:-1,children:[e.jsx(u,{children:m*h+r+1}),e.jsx(u,{children:t.topicName}),e.jsx(u,{children:t.description}),e.jsx(u,{children:t.moduleName}),e.jsx(u,{children:t.url}),e.jsx(u,{children:t.videoUrl}),e.jsx(u,{children:t.file}),e.jsx(u,{align:"right",children:t.createdBy}),e.jsx(u,{align:"right",children:t.updatedBy}),e.jsx(u,{align:"right",children:t.insertedDate}),e.jsx(u,{align:"right",children:t.updatedDate}),e.jsxs(u,{align:"right",children:[e.jsx(O,{onClick:()=>ee(t.topicId),sx:{color:"#03045E"},size:"small",children:e.jsx(he,{})}),e.jsx(O,{onClick:()=>re(t.topicId),color:"error",size:"small",children:e.jsx(fe,{})})]})]},t.topicId))})]})}),e.jsx(ge,{rowsPerPageOptions:[5,10,25],component:"div",count:w.length,rowsPerPage:h,page:m,onPageChange:oe,onRowsPerPageChange:ae})]}),e.jsxs(xe,{open:z,onClose:()=>f(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(ye,{sx:{fontSize:"16px"},children:D?"Edit Topic":"Add Topic"}),e.jsxs(L,{component:"form",onSubmit:D?te:Z,noValidate:!0,sx:{p:3},children:[e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(E,{fullWidth:!0,label:"Topic Name",name:"topicName",value:a.topicName,onChange:N,error:!!c.topicName,helperText:c.topicName,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(E,{fullWidth:!0,label:"Description",name:"description",value:a.description,onChange:N,error:!!c.description,helperText:c.description,multiline:!0,rows:3,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),e.jsx(x,{item:!0,xs:12,children:e.jsxs(je,{fullWidth:!0,error:!!c.moduleId,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}},children:[e.jsx(Ie,{id:"module-select",children:"Module"}),e.jsx(be,{labelId:"module-select",name:"moduleId",value:a.moduleId,onChange:N,children:R.map(t=>e.jsx(Ne,{value:t.moduleId,children:t.moduleName},t.moduleId))}),e.jsx(Ee,{children:c.moduleId})]})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(E,{fullWidth:!0,label:"Url ",name:"url",value:a.url,onChange:N,error:!!c.url,helperText:c.url,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(E,{fullWidth:!0,label:"VideoUrl ",name:"videoUrl",value:a.videoUrl,onChange:N,error:!!c.videoUrl,helperText:c.videoUrl,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),e.jsxs(x,{item:!0,xs:12,children:[e.jsx(E,{margin:"normal",fullWidth:!0,id:"fileName",label:"File Name",name:"fileName",value:a.fileName,disabled:!0,helperText:c.fileName,error:!!c.fileName,InputProps:{endAdornment:e.jsx(T,{variant:"contained",color:"primary",onClick:Y,sx:{backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},children:"Upload"})}}),e.jsx("input",{type:"file",onChange:X,ref:J,style:{marginTop:20},accept:"application/*"})]})]}),e.jsxs(ve,{children:[e.jsx(T,{onClick:()=>f(!1),sx:{color:"#03045E"},children:"Cancel"}),e.jsx(T,{type:"submit",variant:"contained",sx:{backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},children:D?"Update":"Save"})]})]})]})]})};export{Fe as default};
