import{r as s,j as e,M as V,B as D,b,e as q,G as p,g as J,P as _,f as $,h as K,i as Q,k as N,l as v,m as X,I as w,E as Z,D as ee,n as te,o as oe,p as re,q as y,s as ae,t as B}from"./index-D1P8NqU1.js";import{f as se,d as ne,g as ie,u as de,p as le}from"./PromoApi-DkP5JluF.js";const S=[{id:"promoId",label:"ID",align:"center"},{id:"promoName",label:"Name",align:"center"},{id:"description",label:"Description",minWidth:100,align:"center"},{id:"youTube",label:"Youtube",align:"center",format:i=>i?e.jsx("iframe",{width:"150",height:"100",src:`https://www.youtube.com/embed/${ce(i)}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):"No video"},{id:"createdBy",label:"Created By",align:"center"},{id:"updatedBy",label:"Updated By",align:"center"},{id:"insertedDate",label:"Inserted Date",align:"center"},{id:"updatedDate",label:"Updated Date",align:"center"},{id:"actions",label:"Actions",align:"center"}];function ce(i){const m=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,d=i.match(m);return d&&d[2].length===11?d[2]:null}const me=()=>{const[i,m]=s.useState(0),[d,M]=s.useState(10),[j,T]=s.useState([]),[k,c]=s.useState(!1),[x,E]=s.useState(!1),[l,I]=s.useState({}),[R,W]=s.useState(null),P=s.useRef(null),[U,A]=s.useState(!1),[a,h]=s.useState({promoName:"",description:"",youTube:""}),L=(t,o)=>{m(o)},O=t=>{M(+t.target.value),m(0)},g=JSON.parse(sessionStorage.getItem("user")),u={"Content-type":"application/json",Authorization:"Bearer "+g.accessToken},f=t=>{h({...a,[t.target.name]:t.target.value}),I({...l,[t.target.name]:null})},F=()=>{const t={};return(!a.promoName||a.promoName.trim()==="")&&(t.promoName="Enter the Advertisement name"),(!a.description||a.description.trim()==="")&&(t.description="Enter the description"),(!a.youTube||a.youTube.trim()==="")&&(t.youTube="Enter Youtube URL"),t},C=async()=>{try{const o=(await se(u)).content;if(o){const r=o.map(n=>({promoId:n.promoId,promoName:n.promoName,description:n.description,youTube:n.youTube,insertedDate:B(n.insertedDate).format("L"),updatedDate:B(n.updatedDate).format("L"),createdBy:n.createdBy?n.createdBy.userName:"No User",updatedBy:n.updatedBy?n.updatedBy.userName:"No User"}));T(r)}else T([])}catch(t){console.error("Error fetching promo data:",t)}};s.useEffect(()=>{C()},[U]);const z=async t=>{await ne(u,t),C()},H=async t=>{E(!0),c(!0);try{const r=(await ie(u,t)).data;r?(W(r.promoId),h({promoName:r.promoName,description:r.description,youTube:r.youTube})):console.error("No promo data found for id:",t)}catch(o){console.error("Error fetching promo details:",o)}},Y=()=>{E(!1),h({promoName:"",description:"",youTube:""}),c(!0)},G=async t=>{t.preventDefault();const o=F();if(Object.keys(o).length>0)I(o);else try{if(x){const r={...a,promoId:R,updatedBy:{userId:g.userId}};await de(r,u)}else await le({...a,createdBy:{userId:g.userId}},u);h({promoName:"",description:"",youTube:""}),P.current.value=null,A(r=>!r),c(!1)}catch(r){console.error("Error saving promo:",r)}};return e.jsxs(V,{title:e.jsxs(D,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"Promo"}),e.jsxs(b,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px",backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},onClick:Y,children:["Add",e.jsx(q,{sx:{color:"#fff"}})]})]}),children:[e.jsx(p,{container:!0,spacing:J}),e.jsxs(_,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx($,{sx:{maxHeight:440},children:e.jsxs(K,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(Q,{children:e.jsx(N,{children:S.map(t=>e.jsx(v,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(X,{children:j.slice(i*d,i*d+d).map(t=>e.jsx(N,{hover:!0,role:"checkbox",tabIndex:-1,children:S.map(o=>e.jsx(v,{align:o.align,children:o.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(w,{onClick:()=>H(t.promoId),sx:{color:"#03045E"},children:e.jsx(Z,{})}),e.jsx(w,{onClick:()=>z(t.promoId),color:"error",children:e.jsx(ee,{})})]}):o.format?o.format(t[o.id]):t[o.id]},o.id))},t.promoId))})]})}),e.jsx(te,{rowsPerPageOptions:[10,25,100],component:"div",count:j.length,rowsPerPage:d,page:i,onPageChange:L,onRowsPerPageChange:O})]}),e.jsxs(oe,{open:k,onClose:()=>c(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(re,{sx:{fontSize:"16px"},children:x?"Edit Promo":"Add Promo"}),e.jsxs(D,{component:"form",onSubmit:G,noValidate:!0,sx:{p:3},children:[e.jsxs(p,{container:!0,spacing:2,children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Promo Name",name:"promoName",value:a.promoName,onChange:f,error:!!l.promoName,helperText:l.promoName,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Description",name:"description",value:a.description,onChange:f,error:!!l.description,helperText:l.description,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"YouTube URL",name:"youTube",value:a.youTube,onChange:f,error:!!l.youTube,helperText:l.youTube,inputRef:P,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})})]}),e.jsxs(ae,{sx:{pt:3},children:[e.jsx(b,{onClick:()=>c(!1),sx:{color:"#03045E"},children:"Cancel"}),e.jsx(b,{type:"submit",variant:"contained",color:"primary",sx:{backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},children:x?"Update":"Save"})]})]})]})]})};export{me as default};
