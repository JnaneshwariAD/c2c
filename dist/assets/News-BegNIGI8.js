import{d as ee,r as o,j as e,M as te,x as v,b as m,e as ae,G as u,g as se,P as re,f as oe,h as ne,i as ie,k,l as T,m as le,I as F,n as de,o as ce,p as ue,q as x,s as he,t as M,S as w,v as pe,c as U}from"./index-D1P8NqU1.js";import{d as me,a as fe}from"./DeleteForever-DfHvKCdO.js";import{f as ge,d as xe,g as we,u as Ne,a as ye}from"./NewsApi-CD4q0k_C.js";const A=[{id:"newsId",label:"ID",align:"center"},{id:"newsName",label:"Name",align:"center"},{id:"description",label:"Description",minWidth:100},{id:"file",label:"File"},{id:"createdBy",label:"Created By",align:"center"},{id:"updatedBy",label:"Updated By",align:"center"},{id:"insertedDate",label:"Inserted Date",align:"center"},{id:"updatedDate",label:"Updated Date",align:"center"},{id:"actions",label:"Actions",align:"center"}],De=()=>{ee();const[f,N]=o.useState(0),[h,W]=o.useState(10),[y,b]=o.useState([]),[g,j]=o.useState(!1),[O,l]=o.useState(!1),[R,$]=o.useState(null),[be,C]=o.useState(""),[i,E]=o.useState({}),[I,z]=o.useState(null),D=o.useRef(null),[je,S]=o.useState(""),[H,B]=o.useState(!1),[n,d]=o.useState({newsName:"",description:""}),L=(t,a)=>{N(a)},G=t=>{W(+t.target.value),N(0)},p=JSON.parse(sessionStorage.getItem("user")),c={"Content-type":"application/json",Authorization:`Bearer ${p.accessToken}`},_=`${U}/file/downloadFile/?filePath=`,q=async()=>{try{const a=(await ge(c)).data.content;if(a){const s=a.map(r=>({newsId:r.newsId,newsName:r.newsName,description:r.description,file:r.photoPath?e.jsx("img",{src:_+r.photoPath,alt:r.photoName,style:{width:100,height:50}}):"NO IMAGE FOUND",insertedDate:M(r.insertedDate).format("L"),updatedDate:M(r.updatedDate).format("L"),createdBy:r.createdBy?r.createdBy.userName:"No User",updatedBy:r.updatedBy?r.updatedBy.userName:"No User"}));b(s)}else b([])}catch(t){console.error("Error fetching data:",t)}};o.useEffect(()=>{q()},[H]);const J=()=>{const t={};return n.newsName.trim()||(t.newsName="Enter the News"),n.description.trim()||(t.description="Enter the Description"),(!n.photoName||n.photoName.trim()==="")&&(t.photoName="Select the file"),t},P=t=>{d({...n,[t.target.name]:t.target.value}),E(a=>({...a,[t.target.name]:null}))},V=async t=>{try{await xe(t,c),B(a=>!a)}catch(a){console.error("Error deleting news:",a)}},K=async t=>{j(!0),l(!0);try{const s=(await we(t,c)).data;$(s.newsId),d({newsName:s.newsName,description:s.description,photoName:s.photoName})}catch(a){console.error("Error fetching news by ID:",a)}},Q=async t=>{if(t.preventDefault(),!I){S("Please select a file"),w.fire({icon:"warning",title:"No File Selected",text:"Please select a file before uploading.",confirmButtonColor:"#f0ad4e"});return}const a=new FormData;a.append("file",I);try{const s=await pe.post(`${U}/file/uploadFile`,a,{headers:{"content-type":"multipart/form-data",Authorization:`Bearer ${p.accessToken}`}});C(s.data.fileName),d(r=>({...r,photoName:s.data.fileName})),S(""),w.fire({target:document.getElementById("your-dialog-id"),icon:"success",title:"Uploaded",text:s.data.message,timer:2e3,showConfirmButton:!1})}catch(s){console.error("Error uploading file:",s),w.fire({icon:"error",title:"Upload Failed",text:"Something went wrong while uploading the file.",confirmButtonColor:"#d33"})}},X=t=>{C(t.target.files[0].name),z(t.target.files[0])},Y=async t=>{t.preventDefault();const a=J();if(console.log(n),Object.keys(a).length>0)E(a);else try{if(g){const s={...n,newsId:R,updatedBy:{userId:p.userId}};await Ne(s,c)}else{const s={...n,createdBy:{userId:p.userId}};await ye(s,c)}d({newsName:"",description:"",photoName:""}),D.current.value=null,B(s=>!s),l(!1)}catch(s){console.error("Error saving news:",s)}},Z=()=>{j(!1),d({newsName:"",description:"",photoName:""}),l(!0)};return e.jsxs(te,{title:e.jsxs(v,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"News"}),e.jsxs(m,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px",backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},onClick:Z,children:["Add",e.jsx(ae,{sx:{color:"#fff"}})]})]}),children:[e.jsx(u,{container:!0,spacing:se}),e.jsxs(re,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(oe,{sx:{maxHeight:440},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(ie,{children:e.jsx(k,{children:A.map(t=>e.jsx(T,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(le,{children:y.slice(f*h,f*h+h).map(t=>e.jsx(k,{hover:!0,role:"checkbox",tabIndex:-1,children:A.map(a=>e.jsx(T,{align:a.align,children:a.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(F,{onClick:()=>K(t.newsId),color:"primary",children:e.jsx(me,{})}),e.jsx(F,{onClick:()=>V(t.newsId),color:"error",children:e.jsx(fe,{})})]}):t[a.id]},a.id))},t.newsId))})]})}),e.jsx(de,{rowsPerPageOptions:[10,25,100],component:"div",count:y.length,rowsPerPage:h,page:f,onPageChange:L,onRowsPerPageChange:G})]}),e.jsxs(ce,{open:O,onClose:()=>l(!1),fullWidth:!0,maxWidth:"md",id:"your-dialog-id",children:[e.jsx(ue,{sx:{fontSize:"16px"},children:g?"Edit News":"Add News"}),e.jsxs(v,{component:"form",onSubmit:Y,noValidate:!0,sx:{p:3},children:[e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"News Name",name:"newsName",value:n.newsName,onChange:P,error:!!i.newsName,helperText:i.newsName,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"Description",name:"description",value:n.description,onChange:P,error:!!i.description,helperText:i.description,multiline:!0,rows:3,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(x,{margin:"normal",fullWidth:!0,id:"photoName",label:"File Name",name:"photoName",autoComplete:"photoName",value:n.photoName,disabled:!0,helperText:i.photoName,error:!!i.photoName,InputProps:{endAdornment:e.jsx(m,{variant:"contained",onClick:Q,sx:{backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},children:"Upload"})}}),e.jsx("input",{type:"file",onChange:X,ref:D,style:{marginTop:20}})]})]}),e.jsxs(he,{children:[e.jsx(m,{onClick:()=>l(!1),sx:{color:"#03045E"},children:"Cancel"}),e.jsx(m,{type:"submit",variant:"contained",sx:{backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},children:g?"Update":"Save"})]})]})]})]})};export{De as default};
