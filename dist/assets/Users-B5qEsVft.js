import{d as X,r as n,j as r,M as Y,B,b as E,e as Z,G as i,g as ee,P as re,f as ae,h as se,i as te,k as y,l as w,m as le,I as P,E as oe,D as ne,n as ie,o as de,p as ue,q as h,F as ce,A as me,H as he,J as fe,K as be,s as xe,t as R}from"./index-D1P8NqU1.js";import{f as pe,g as ge,d as Ne,a as je,u as Ie}from"./UsersApi-DzfOKQVp.js";import{f as Ee}from"./RoleApi-BrO8wqZZ.js";const C=[{id:"userId",label:"ID",align:"center"},{id:"userName",label:"Name",align:"center"},{id:"email",label:"Email",align:"center"},{id:"mobileNumber",label:"Mobile Number",align:"center"},{id:"roleName",label:"Role",minWidth:150,align:"center"},{id:"createdBy",label:"Created By",align:"center"},{id:"updatedBy",label:"Updated By",align:"center"},{id:"insertedDate",label:"Inserted Date",align:"center"},{id:"updatedDate",label:"Updated Date",align:"center"},{id:"actions",label:"Actions",align:"center"}],De=()=>{X();const[x,D]=n.useState(0),[f,k]=n.useState(10),[W,O]=n.useState([]),[p,M]=n.useState([]),[A,d]=n.useState(!1),[g,v]=n.useState(!1),[s,N]=n.useState({userName:"",fullName:"",email:"",mobileNumber:"",password:""}),[o,m]=n.useState({}),[S,j]=n.useState(!1),[F,L]=n.useState(null),H=(e,a)=>{D(a)},z=e=>{k(+e.target.value),D(0)},I=JSON.parse(sessionStorage.getItem("user")),u={"Content-type":"application/json",Authorization:"Bearer "+I.accessToken},T=async()=>{try{const a=(await pe(u)).data.content;if(a){const l=a.map(t=>({userId:t.userId,userName:t.userName,fullName:t.fullName,email:t.email,mobileNumber:t.mobileNumber,password:t.password,roleName:t.roleDto?t.roleDto.roleName:"No Role Name",insertedDate:R(t.insertedDate).format("L"),updatedDate:R(t.updatedDate).format("L"),createdBy:t.createdBy?t.createdBy.userName:"No User",updatedBy:t.updatedBy?t.updatedBy.userName:"No User"}));M(l)}else M([])}catch(e){console.error("Error fetching users:",e)}},G=async()=>{try{const a=(await Ee(u)).data;if(a){const t=a.sort((b,Q)=>b.roleName.localeCompare(Q.roleName)).map(b=>({roleId:b.roleId,roleName:b.roleName}));O(t)}}catch(e){console.error("Error fetching roles:",e)}};n.useEffect(()=>{T(),G()},[S]);const U=()=>{const e={};return(!s.userName||s.userName.trim()==="")&&(e.userName="Enter the user name"),(!s.fullName||s.fullName.trim()==="")&&(e.fullName="Enter the full name"),!s.email||s.email.trim()===""?e.email="Enter the email Id":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)||(e.email="Enter a valid email address"),!s.mobileNumber||s.mobileNumber.trim()===""?e.mobileNumber="Enter the mobile number":/^[0-9]{10,15}$/.test(s.mobileNumber)||(e.mobileNumber="Enter a valid mobile number"),!s.password||s.password.trim()===""?e.password="Enter the password":s.password.length<6&&(e.password="Password must be at least 6 characters"),s.roleId||(e.roleId="Select a role"),e},c=e=>{N({...s,[e.target.name]:e.target.value}),m({...o,[e.target.name]:null})},J=()=>{v(!1),N({userName:"",fullName:"",email:"",mobileNumber:"",password:""}),m({}),d(!0)},$=async e=>{e.preventDefault();const a=U();if(Object.keys(a).length>0){m(a);return}const l={userName:s.userName,fullName:s.fullName,email:s.email,mobileNumber:s.mobileNumber,password:s.password,roleDto:{roleId:s.roleId},createdBy:{userId:I.userId}};console.log(l);try{const t=await je(l,u);t.data.responseCode===201?(j(!S),d(!1),T()):alert(t.data.errorMessage||"Failed to add user.")}catch{}},q=async e=>{v(!0),d(!0);try{const l=(await ge(e,u)).data;console.log(l),L(l.userId),N({userName:l.userName,fullName:l.fullName,email:l.email,mobileNumber:l.mobileNumber,password:l.password,roleId:l.roleDto?l.roleDto.roleId:""}),m({})}catch(a){console.error("Error fetching user details:",a)}},K=async()=>{try{const e={...s,userId:F,updatedBy:{userId:I.userId}},a=await Ie(e,u);console.log("User updated:",a),j(l=>!l),d(!1)}catch(e){console.error("Error updating user:",e)}},V=async e=>{if(window.confirm("Are you sure you want to delete this user?"))try{await Ne(e,u),j(a=>!a)}catch(a){console.error("Error deleting user:",a)}},_=async e=>{e.preventDefault();const a=U();if(Object.keys(a).length>0){m(a);return}g?await K():await $(e)};return r.jsxs(Y,{title:r.jsxs(B,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{children:"Users"}),r.jsxs(E,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px",backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},onClick:J,children:["Add",r.jsx(Z,{sx:{color:"#fff",ml:1}})]})]}),children:[r.jsx(i,{container:!0,spacing:ee}),r.jsxs(re,{sx:{width:"100%",overflow:"hidden",mt:2},children:[r.jsx(ae,{sx:{maxHeight:440},children:r.jsxs(se,{stickyHeader:!0,"aria-label":"sticky table",children:[r.jsx(te,{children:r.jsx(y,{children:C.map(e=>r.jsx(w,{align:e.align?e.align:"left",style:{minWidth:e.minWidth,fontWeight:600,fontSize:15},children:e.label},e.id))})}),r.jsxs(le,{children:[p.slice(x*f,x*f+f).map(e=>r.jsx(y,{hover:!0,role:"checkbox",tabIndex:-1,children:C.map(a=>{const l=e[a.id];return r.jsx(w,{align:a.align?a.align:"left",children:a.id==="actions"?r.jsxs(r.Fragment,{children:[r.jsx(P,{sx:{color:"#03045E"},onClick:()=>q(e.userId),children:r.jsx(oe,{})}),r.jsx(P,{color:"error",onClick:()=>V(e.userId),children:r.jsx(ne,{})})]}):l||"No Data"},a.id)})},e.userId)),p.length===0&&r.jsx(y,{children:r.jsx(w,{colSpan:C.length,align:"center",children:"No users found."})})]})]})}),r.jsx(ie,{rowsPerPageOptions:[10,25,100],component:"div",count:p.length,rowsPerPage:f,page:x,onPageChange:H,onRowsPerPageChange:z})]}),r.jsxs(de,{open:A,onClose:()=>d(!1),fullWidth:!0,maxWidth:"md",children:[r.jsx(ue,{sx:{fontSize:"16px"},children:g?"Edit User":"Add User"}),r.jsxs(B,{component:"form",noValidate:!0,sx:{p:3},onSubmit:_,children:[r.jsxs(i,{container:!0,spacing:2,children:[r.jsx(i,{item:!0,xs:12,children:r.jsx(h,{fullWidth:!0,label:"User Name",name:"userName",value:s.userName,onChange:c,error:!!o.userName,helperText:o.userName,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),r.jsx(i,{item:!0,xs:12,children:r.jsx(h,{fullWidth:!0,label:"Full Name",name:"fullName",value:s.fullName,onChange:c,error:!!o.fullName,helperText:o.fullName,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),r.jsx(i,{item:!0,xs:12,children:r.jsx(h,{fullWidth:!0,label:"Email",name:"email",value:s.email,onChange:c,error:!!o.email,helperText:o.email,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),r.jsx(i,{item:!0,xs:12,children:r.jsx(h,{fullWidth:!0,label:"Mobile Number",name:"mobileNumber",value:s.mobileNumber,onChange:c,error:!!o.mobileNumber,helperText:o.mobileNumber,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),r.jsx(i,{item:!0,xs:12,children:r.jsx(h,{fullWidth:!0,label:"Password",name:"password",type:"password",value:s.password,onChange:c,error:!!o.password,helperText:o.password,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}}})}),r.jsx(i,{item:!0,xs:12,children:r.jsxs(ce,{fullWidth:!0,error:!!o.roleId,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#03045E"}},"& .MuiInputLabel-root.Mui-focused":{color:"#03045E"}},children:[r.jsx(me,{children:"Role"}),r.jsx(he,{name:"roleId",value:s.roleId,onChange:c,label:"Role",children:W.map(e=>r.jsx(fe,{value:e.roleId,children:e.roleName},e.roleId))}),o.roleId&&r.jsx(be,{children:o.roleId})]})})]}),r.jsxs(xe,{children:[r.jsx(E,{onClick:()=>d(!1),sx:{color:"#03045E"},children:"Cancel"}),r.jsx(E,{type:"submit",variant:"contained",sx:{backgroundColor:"#03045E","&:hover":{backgroundColor:"#03045E",opacity:.9}},children:g?"Update":"Save"})]})]})]})]})};export{De as default};
